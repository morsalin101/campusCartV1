Pranto F, [8/8/2025 9:51 PM]
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Order List - CampusCart</title>
  <link rel="stylesheet" href="../assets/css/theme.min.css" />
  <link href="../assets/libs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="../assets/libs/feather-webfont/dist/feather-icons.css" rel="stylesheet" />
  <link href="../assets/libs/simplebar/dist/simplebar.min.css" rel="stylesheet" />
</head>

<body>
  <!-- navbar -->
  <div th:replace="fragments/Nav :: admin_nav"></div>

  <div class="main-wrapper">
    <!-- sidebar -->
    <div th:replace="fragments/sidebar :: sidebar"></div>

    <!-- main content -->
    <main class="main-content-wrapper">
      <div class="container">
        <div class="row mb-8">
          <div class="col-md-12">
            <h2>Order List</h2>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-12 col-12 mb-5">
            <div class="card h-100 card-lg">
              <div class="p-6">
                <div class="row justify-content-between">
                  <div class="col-md-4">
                    <form class="d-flex" th:action="@{/admin/orders/search}" method="get">
                      <input class="form-control" type="search" name="query" placeholder="Search..." />
                    </form>
                  </div>
                  <div class="col-md-3">
                    <select class="form-select" th:name="status">
                      <option value="">All Status</option>
                      <option value="SUCCESS">Success</option>
                      <option value="PENDING">Pending</option>
                      <option value="CANCEL">Cancel</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-centered table-hover text-nowrap table-borderless mb-0 table-with-checkbox">
                    <thead class="bg-light">
                      <tr>
                        <th><input class="form-check-input" type="checkbox" id="checkAll" /></th>
                        <th>Order ID</th>
                        <th>Order Date</th>
                        <!--                        <th>Customer</th>-->
                        <!--                        <th>Payment Method</th>-->
                        <th>Status</th>
                        <th>Amount</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                      <!-- Orders will be inserted here dynamically -->
                    </tbody>
                  </table>
                </div>
              </div>




            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/libs/simplebar/dist/simplebar.min.js"></script>
  <script src="../assets/js/theme.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      function loadOrders() {
        $.ajax({
          url: '/article/allorders',
          method: 'GET',
          dataType: 'json',
          success: function (data) {
            const $tbody = $('#ordersTableBody');
            $tbody.empty(); // Clear any existing rows

            data.forEach(order => {
              const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleDateString() : '';
              const userName = order.user ? order.user.name : '';
              const paymentMethod = order.payment ? order.payment.method : '';


              // Status dropdown HTML with current status selected
              const statusOptions = ['SUCCESS', 'PENDING', 'CANCEL']
                .map(status => `<option value="${status}" ${order.orderStatus === status ? 'selected' : ''}>${status}</option>`)
                .join('');

              const row = `
              <tr data-order-id="${order.id}">
                <td><input class="form-check-input" type="checkbox" /></td>
                <td>${order.id}</td>
                <td>${orderDate}</td>

                <td>
                  <select class="form-select order-status-dropdown">
                    ${statusOptions}
                  </select>
                </td>
                <td>${order.orderTotal}</td>
                <td>
                  <a href="/orders/${order.id}" class="btn btn-sm btn-primary">View</a>
                </td>
              </tr>
            `;

              $tbody.append(row);
            });
          },
          error: function (xhr, status, error) {
            console.error('Error fetching orders:', error);
          }
        });
      }

      // Initial load
      loadOrders();

      // Delegate change event for dynamically created dropdowns
      $('#ordersTableBody').on('change', '.order-status-dropdown', function () {
        const $select = $(this);
        const newStatus = $select.val();
        const orderId = $select.closest('tr').data('order-id');

        $.ajax({
          url: `/article/orders/${orderId}/status`,
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ orderStatus: newStatus }),
          success: function () {
            alert(`Order #${orderId} status updated to ${newStatus}`);
          },
          error: function (xhr, status, error) {
            alert('Failed to update order status');
            console.error('Error updating order status:', error);
            // Optionally revert the dropdown to previous value or reload orders
            loadOrders();
          }
        });
      });
    });
  </script>

</body>

</html>