<!doctype html>
<html lang="en" xmlns:th="http://www.w3.org./1999/xhtml">

<head th:replace="fragments/header :: common-header" />

<style>
  /* Optional: Custom style for the small arrow icon */
  .small-icon {
    width: 1rem;
    height: 1rem;
  }
</style>

<body class="d-flex flex-column">
  <div th:replace="fragments/header :: navbar"> </div>

  <div class="container page-content py-5">
    <form th:action="@{/checkout}" method="post">
      <div class="row">

        <div class="col-lg-8 mb-3">
          <div th:if="${missingRequiredField}">
            <h5 class="alert alert-warning">There are some required fields missing.</h5>
          </div>
          <div id="accordion">
            <div class="card mb-1">
              <div class="card-header bg-white" id="headingOne">
                <h5 class="mb-0">
                  <button class="btn btn-link checkout-header" data-toggle="collapse" data-target="#collapseOne"
                    aria-expanded="true" aria-controls="collapseOne">
                    REVIEW ITEMS <i data-feather="chevron-down" class="mb-1"></i>
                  </button>
                </h5>
              </div>
              <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body border-bottom">
                  <div class="row align-items-center border-bottom pb-2 pt-2" th:each="cartItem : ${cartItemList}">
                    <div class="col-12 col-md-6 mb-2">
                      <div class="row align-items-center">
                        <div class="col-4">
                          <a th:href="@{/article-detail(id=${cartItem.article.id})}">
                            <img class="cart-img img-fluid" th:src="@{'/products/' + ${cartItem.article.picture}}"
                              th:alt="${cartItem.article.title}" />
                          </a>
                        </div>
                        <div class="col-8">
                          <a th:href="@{/article-detail?id=}+${cartItem.article.id}" class="h6 bold d-inline-block"
                            th:text=${cartItem.article.title}></a>
                          <div><i data-feather="check-circle" class="text-success"></i> In Stock</div>
                          <div><small><b>Size</b>: <span th:text="${cartItem.size}"></span></small></div>
                          <small><b>Unit Price</b>: $<span
                              th:text="${#numbers.formatDecimal(cartItem.article.price, 0, 'COMMA', 2, 'POINT')}"></span></small>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 col-md-6 text-end">
                      <span class="text-muted">
                        <span th:text="${cartItem.qty}">1</span> unit(s) &times;&nbsp;price:
                      </span>
                      <span class="fw-semibold text-primary ms-1">
                        $<span th:id="'price' + ${cartItem.id}"
                          th:text="${#numbers.formatDecimal(cartItem.subtotal, 0, 'COMMA', 2, 'POINT')}">0.00</span>
                      </span>
                    </div>
                  </div>
                  <div class="d-flex flex-wrap justify-content-between align-items-center mt-3">
                    <a th:href="@{/shopping-cart/cart}" class="btn btn-info rounded-sm py-2 px-4"><i
                        data-feather="arrow-left"></i> Edit cart</a>
                    <a data-toggle="collapse" data-parent="#accordion" class="btn btn-primary rounded-sm py-2 px-4"
                      href="#collapseTwo">Next <i data-feather="arrow-right"></i></a>
                  </div>
                </div>
              </div>
            </div>

            <div class="card mb-1">
              <div class="card-header bg-white" id="headingTwo">
                <h5 class="mb-0">
                  <button class="btn btn-link checkout-header collapsed" data-toggle="collapse"
                    data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    SHIPPING <i data-feather="chevron-down" class="mb-1"></i>
                  </button>
                </h5>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                <div class="card-body border-bottom">
                  <div class="form-row">
                    <div class="form-group col-12">
                      <label for="receiver">Receiver Name</label>
                      <input type="text" class="form-control" id="receiver" name="receiver" required="required" />
                    </div>
                    <div class="form-group col-12">
                      <label for="streetAddress">Address</label>
                      <input type="text" class="form-control" id="streetAddress" name="streetAddress"
                        required="required" />
                    </div>
                    <div class="form-group col-4">
                      <label for="city">City</label> <input type="text" class="form-control" id="city" th:name="city"
                        required="required" />
                    </div>
                    <div class="form-group col-4">
                      <label for="country">Country</label> <input type="text" class="form-control" id="country"
                        th:name="country" required="required" />
                    </div>
                    <div class="form-group col-4">
                      <label for="zipCode">Zipcode</label> <input type="text" class="form-control" id="zipCode"
                        th:name="zipCode" required="required" />
                    </div>
                  </div>
                  <div class="mt-2 text-right">
                    <a data-toggle="collapse" data-parent="#accordion" class="btn btn-primary rounded-sm py-2 px-4"
                      href="#collapseThree">Next <i data-feather="arrow-right"></i></a>
                  </div>
                </div>
              </div>
            </div>

            <div class="card mb-1">
              <div class="card-header bg-white" id="headingThree">
                <h5 class="mb-0">
                  <button class="btn btn-link checkout-header collapsed" data-toggle="collapse"
                    data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    PAYMENT <i data-feather="chevron-down" class="mb-1"></i>
                  </button>
                </h5>
              </div>
              <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                <div class="card-body border-bottom">

                  <!-- Payment method selection -->
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="type" id="codOption" value="cod" checked>
                    <label class="form-check-label" for="codOption">
                      Cash on Delivery
                    </label>
                  </div>
                  <div class="form-check mt-2">
                    <input class="form-check-input" type="radio" name="type" id="bkashOption" value="bkash">
                    <label class="form-check-label" for="bkashOption">
                      <img src="/image/bkash-logo.png" alt="bKash" style="height: 24px; vertical-align: middle;" />
                      bKash (Send to: <strong>01778106042</strong>)
                    </label>
                  </div>

                  <!-- bKash transaction id input (hidden/shown dynamically) -->
                  <div id="bkashTransactionSection" class="mt-3" style="display: none;">
                    <div class="form-group">
                      <label for="transactionId">bKash Transaction ID:</label>
                      <input type="text" class="form-control" id="transactionId" name="transactionId"
                        placeholder="e.g., TX1234567" />
                    </div>
                  </div>
                </div>
              </div>
            </div>


          </div>
        </div>

        <div class="col-lg-4">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title mb-4">ORDER SUMMARY</h4>
              <div class="d-flex justify-content-between mb-2">
                <span>Cart subtotal</span>
                <span
                  th:text="'$'+${#numbers.formatDecimal(shoppingCart.getGrandTotal(), 1, 'COMMA', 2, 'POINT')}">$1,200.00</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span>Shipping <i data-feather="arrow-right" class="small-icon"></i></span>
                <span>$0.00</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between font-weight-bold mb-4">
                <span>Total</span>
                <span
                  th:text="'$'+${#numbers.formatDecimal(shoppingCart.getGrandTotal(), 1, 'COMMA', 2, 'POINT')}">$1,200.00</span>
              </div>
              <button type="submit" class="btn btn-primary  w-100 py-2">Place your order</button>
              <p class="text-muted text-center small mt-2">
                By placing your order, you agree to Shoepp privacy notice and conditions.
              </p>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div th:replace="fragments/header :: footer"> </div>
  <div th:replace="common/header :: body-scripts"> </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const codOption = document.getElementById('codOption');
      const bkashOption = document.getElementById('bkashOption');
      const transactionSection = document.getElementById('bkashTransactionSection');
      const transactionInput = document.getElementById('transactionId');

      function toggleBkashInput() {
        if (bkashOption.checked) {
          transactionSection.style.display = 'block';
          transactionInput.setAttribute('required', 'required');
        } else {
          transactionSection.style.display = 'none';
          transactionInput.removeAttribute('required');
          transactionInput.value = '';
        }
      }

      codOption.addEventListener('change', toggleBkashInput);
      bkashOption.addEventListener('change', toggleBkashInput);

      toggleBkashInput(); // initialize on page load
    });
  </script>
</body>

</html>